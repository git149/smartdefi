# 预售信息监听功能说明

## 功能概述

当前的事件监听功能已经增强，能够在检测到`TokenPresalePairCreated`事件时，自动获取并展示完整的预售配置信息和代币基础信息。

## 可获取的信息

### 第一组 - 预售配置信息

通过监听事件和调用预售合约的view函数，可以获取以下信息：

| 信息项 | 中文名称 | 获取方式 | 状态 |
|--------|----------|----------|------|
| Token for LGE | 流动性生成事件代币 | 事件参数 | ✅ 可获取 |
| TST/TRX 汇率 | TST/TRX汇率 | presaleEthAmount/tradeEthAmount | ✅ 可获取 |
| Soft cap | 软顶 | maxTotalNum * presaleEthAmount | ✅ 可获取 |
| Hard cap | 硬顶 | hardcap() | ✅ 可获取 |
| Min buy | 最小购买量 | presaleEthAmount | ✅ 可获取 |
| Max buy | 最大购买量 | maxBuyPerWallet() | ✅ 可获取 |
| Start time | 开始时间 | startTime() | ✅ 可获取 |
| End time | 结束时间 | 计算得出 | ✅ 可获取 |
| Duration | 持续时间 | 计算得出 | ✅ 可获取 |
| Vesting delay | 释放延迟 | getLGEConfig()[0] | ✅ 可获取 |
| Vesting rate(%) | 释放比例 | getLGEConfig()[1] | ✅ 可获取 |
| Vesting rounds | 释放轮次 | getLGEConfig()[2] | ✅ 可获取 |
| TRX pair | TRX交易对 | pairTRX() | ✅ 可获取 |
| Backing | 背书/支持 | getLGEConfig()[3,4] | ✅ 可获取 |

### 第二组 - 代币基础信息

通过调用代币合约的view函数，可以获取以下信息：

| 信息项 | 中文名称 | 获取方式 | 状态 |
|--------|----------|----------|------|
| Token name | 代币名称 | name() | ✅ 可获取 |
| Name(Symbol) | 代币符号 | symbol() | ✅ 可获取 |
| Supply | 总供应量 | totalSupply() | ✅ 可获取 |
| Tokenomic preset | 代币经济学预设 | baseConfig() | ✅ 可获取 |

## 实现特点

### 1. 自动触发
- 当检测到`TokenPresalePairCreated`事件时，自动获取所有相关信息
- 无需手动操作，实现完全自动化

### 2. 分组展示
- **第一组**：预售配置信息（14项）
- **第二组**：代币基础信息（4项）
- 信息按组分类，便于查看

### 3. 格式化显示
- 所有TRON地址使用Base58格式（TRX...开头）
- 时间戳转换为可读的日期时间格式
- 数值自动格式化，添加千分位分隔符
- 百分比和单位自动添加

### 4. 错误处理
- 每个信息获取都有独立的错误处理
- 获取失败时显示"获取失败"，不影响其他信息
- 提供降级方案，确保基本功能可用

### 5. 清晰标签
- 每个信息都有中英文对照标签
- 使用emoji图标增强可读性
- 重要信息用不同颜色高亮显示

## 日志展示示例

```
🎯 检测到新的代币预售配对创建事件！
📍 代币地址: TRX7QjFng9aw8w8DGd2947bSLkdRaRha4qTrx
📍 预售地址: TRX8QjFng9aw8w8DGd2947bSLkdRaRha4qTry
📦 区块号: 12345678
🔗 交易ID: 0x1234567890abcdef...

=== 第一组 - 预售配置信息 ===
🪙 Token for LGE（流动性生成事件代币）: 预售合约地址
💱 TST/TRX 汇率: 1 TRX = 2.0000 TST
🎯 Soft cap（软顶）: 1,000 TRX
🎯 Hard cap（硬顶）: 10,000 TRX
💰 Min buy（最小购买量）: 0.1 TRX
💰 Max buy（最大购买量）: 100 TRX
⏰ Start time（开始时间）: 2024-01-15 10:00:00
⏰ End time（结束时间）: 2024-01-22 10:00:00
⏱️ Duration（持续时间）: 7 天
⏳ Vesting delay（释放延迟）: 30 天
📊 Vesting rate(%)（释放比例）: 10%
🔄 Vesting rounds（释放轮次）: 启用
🏦 Backing（背书/支持）: 25% -> TRXxxxxxxxxxxxxx

=== 第二组 - 代币基础信息 ===
📛 Token name（代币名称）: Test Token
🏷️ Name(Symbol)（代币符号）: TST
💰 Supply（总供应量）: 1,000,000,000
⚙️ Tokenomic preset（代币经济学预设）:
  - 买入手续费: 3%
  - 卖出手续费: 5%
  - LP燃烧启用: 是
  - LP燃烧频率: 86400
  - LP燃烧比例: 2%

=== 补充信息获取 ===
🔗 TRX pair（TRX交易对）: TRXyyyyyyyyyyyyyy
=== 预售配置信息获取完成 ===
```

## 测试功能

页面提供了"📊 测试预售信息展示"按钮，可以：
- 模拟TokenPresalePairCreated事件
- 测试信息获取和展示逻辑
- 验证格式化和错误处理

## 技术实现

### ABI支持
- 优先加载完整的ABI文件
- 提供基础ABI作为备用方案
- 支持CoordinatorFactory、Presale、Token三种合约

### 合约调用
- 使用TronWeb进行合约交互
- 支持BigInt和普通数字类型
- 自动处理地址格式转换

### 异步处理
- 所有合约调用都是异步的
- 显示"正在获取..."提示
- 不阻塞界面响应

## 使用方法

1. 打开simple-event-monitor.html页面
2. 点击"🚀 启动监听"开始监听事件
3. 当有新的代币预售配对创建时，自动展示所有信息
4. 也可以点击"📊 测试预售信息展示"进行功能测试

## 注意事项

- 确保TronWeb库正确加载
- 需要网络连接以访问TRON节点
- 某些信息可能因合约实现差异而获取失败
- 所有地址都使用Base58格式显示，符合TRON标准
