<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Web3åŠŸèƒ½æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        .test-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            backdrop-filter: blur(10px);
        }
        .status {
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .success { background: rgba(76, 175, 80, 0.3); }
        .error { background: rgba(244, 67, 54, 0.3); }
        .warning { background: rgba(255, 152, 0, 0.3); }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #0056b3; }
        .result {
            background: rgba(0, 0, 0, 0.2);
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            font-family: monospace;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <h1>ğŸ§ª Web3åŠŸèƒ½æµ‹è¯•é¡µé¢</h1>
    
    <div class="test-card">
        <h2>ğŸ“ å½“å‰è®¿é—®æ–¹å¼æ£€æµ‹</h2>
        <div id="protocolInfo" class="result"></div>
    </div>

    <div class="test-card">
        <h2>ğŸ”Œ MetaMaskæ£€æµ‹</h2>
        <button onclick="testMetaMask()">æ£€æµ‹MetaMask</button>
        <div id="metamaskResult" class="result"></div>
    </div>

    <div class="test-card">
        <h2>ğŸŒ ç½‘ç»œè¯·æ±‚æµ‹è¯•</h2>
        <button onclick="testNetworkRequest()">æµ‹è¯•BSCç½‘ç»œè¯·æ±‚</button>
        <div id="networkResult" class="result"></div>
    </div>

    <div class="test-card">
        <h2>ğŸ’¾ æœ¬åœ°å­˜å‚¨æµ‹è¯•</h2>
        <button onclick="testLocalStorage()">æµ‹è¯•LocalStorage</button>
        <div id="storageResult" class="result"></div>
    </div>

    <div class="test-card">
        <h2>ğŸ“¦ å¤–éƒ¨èµ„æºæµ‹è¯•</h2>
        <button onclick="testExternalResources()">æµ‹è¯•CDNèµ„æº</button>
        <div id="resourceResult" class="result"></div>
    </div>

    <script src="https://cdn.ethers.io/lib/ethers-5.7.2.umd.min.js"></script>
    <script>
        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æ£€æµ‹åè®®
        window.addEventListener('load', function() {
            detectProtocol();
        });

        function detectProtocol() {
            const protocol = window.location.protocol;
            const host = window.location.host;
            const pathname = window.location.pathname;
            
            let info = `åè®®: ${protocol}\n`;
            info += `ä¸»æœº: ${host || 'æœ¬åœ°æ–‡ä»¶'}\n`;
            info += `è·¯å¾„: ${pathname}\n`;
            info += `å®Œæ•´URL: ${window.location.href}\n\n`;
            
            if (protocol === 'file:') {
                info += 'âš ï¸ è­¦å‘Š: æ‚¨æ­£åœ¨ä½¿ç”¨file://åè®®è®¿é—®\n';
                info += 'è¿™å¯èƒ½å¯¼è‡´Web3åŠŸèƒ½å—é™ï¼\n\n';
                info += 'å»ºè®®ä½¿ç”¨HTTPæœåŠ¡å™¨è®¿é—®ï¼š\n';
                info += '1. npm run serve\n';
                info += '2. python -m http.server\n';
                info += '3. æˆ–å…¶ä»–HTTPæœåŠ¡å™¨';
                document.getElementById('protocolInfo').className = 'result warning';
            } else if (protocol === 'http:' || protocol === 'https:') {
                info += 'âœ… æ­£åœ¨ä½¿ç”¨HTTPåè®®ï¼ŒWeb3åŠŸèƒ½åº”è¯¥æ­£å¸¸';
                document.getElementById('protocolInfo').className = 'result success';
            }
            
            document.getElementById('protocolInfo').textContent = info;
        }

        async function testMetaMask() {
            const resultDiv = document.getElementById('metamaskResult');
            let result = 'ğŸ” MetaMaskæ£€æµ‹ç»“æœ:\n\n';
            
            try {
                // æ£€æµ‹window.ethereum
                if (typeof window.ethereum === 'undefined') {
                    result += 'âŒ window.ethereum æœªæ‰¾åˆ°\n';
                    result += 'è¯·å®‰è£…MetaMaské’±åŒ…\n';
                    resultDiv.className = 'result error';
                } else {
                    result += 'âœ… window.ethereum å·²æ‰¾åˆ°\n';
                    result += `æä¾›å•†: ${window.ethereum.isMetaMask ? 'MetaMask' : 'å…¶ä»–é’±åŒ…'}\n`;
                    
                    // å°è¯•è¿æ¥
                    try {
                        const accounts = await window.ethereum.request({ 
                            method: 'eth_requestAccounts' 
                        });
                        result += `âœ… è¿æ¥æˆåŠŸ\n`;
                        result += `è´¦æˆ·: ${accounts[0]}\n`;
                        
                        // è·å–ç½‘ç»œä¿¡æ¯
                        const chainId = await window.ethereum.request({ 
                            method: 'eth_chainId' 
                        });
                        result += `ç½‘ç»œID: ${parseInt(chainId, 16)}\n`;
                        
                        resultDiv.className = 'result success';
                    } catch (connectError) {
                        result += `âš ï¸ è¿æ¥å¤±è´¥: ${connectError.message}\n`;
                        resultDiv.className = 'result warning';
                    }
                }
            } catch (error) {
                result += `âŒ æ£€æµ‹å¤±è´¥: ${error.message}\n`;
                resultDiv.className = 'result error';
            }
            
            resultDiv.textContent = result;
        }

        async function testNetworkRequest() {
            const resultDiv = document.getElementById('networkResult');
            let result = 'ğŸŒ ç½‘ç»œè¯·æ±‚æµ‹è¯•:\n\n';
            
            try {
                // æµ‹è¯•BSCæµ‹è¯•ç½‘RPCè¯·æ±‚
                const response = await fetch('https://data-seed-prebsc-1-s1.binance.org:8545/', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        jsonrpc: '2.0',
                        method: 'eth_blockNumber',
                        params: [],
                        id: 1
                    })
                });
                
                if (response.ok) {
                    const data = await response.json();
                    result += 'âœ… BSCæµ‹è¯•ç½‘è¿æ¥æˆåŠŸ\n';
                    result += `å½“å‰åŒºå—: ${parseInt(data.result, 16)}\n`;
                    resultDiv.className = 'result success';
                } else {
                    result += `âŒ è¯·æ±‚å¤±è´¥: ${response.status}\n`;
                    resultDiv.className = 'result error';
                }
            } catch (error) {
                result += `âŒ ç½‘ç»œè¯·æ±‚å¤±è´¥: ${error.message}\n`;
                if (error.message.includes('CORS')) {
                    result += '\nè¿™é€šå¸¸æ˜¯ç”±äºCORSé™åˆ¶å¯¼è‡´çš„\n';
                    result += 'file://åè®®ä¸‹ç»å¸¸å‡ºç°æ­¤é—®é¢˜';
                }
                resultDiv.className = 'result error';
            }
            
            resultDiv.textContent = result;
        }

        function testLocalStorage() {
            const resultDiv = document.getElementById('storageResult');
            let result = 'ğŸ’¾ æœ¬åœ°å­˜å‚¨æµ‹è¯•:\n\n';
            
            try {
                // æµ‹è¯•localStorage
                const testKey = 'web3_test_' + Date.now();
                const testValue = 'test_data';
                
                localStorage.setItem(testKey, testValue);
                const retrieved = localStorage.getItem(testKey);
                
                if (retrieved === testValue) {
                    result += 'âœ… localStorage å·¥ä½œæ­£å¸¸\n';
                    localStorage.removeItem(testKey);
                    resultDiv.className = 'result success';
                } else {
                    result += 'âŒ localStorage è¯»å–å¤±è´¥\n';
                    resultDiv.className = 'result error';
                }
                
                // æµ‹è¯•sessionStorage
                sessionStorage.setItem(testKey, testValue);
                const sessionRetrieved = sessionStorage.getItem(testKey);
                
                if (sessionRetrieved === testValue) {
                    result += 'âœ… sessionStorage å·¥ä½œæ­£å¸¸\n';
                    sessionStorage.removeItem(testKey);
                } else {
                    result += 'âŒ sessionStorage è¯»å–å¤±è´¥\n';
                }
                
            } catch (error) {
                result += `âŒ å­˜å‚¨æµ‹è¯•å¤±è´¥: ${error.message}\n`;
                resultDiv.className = 'result error';
            }
            
            resultDiv.textContent = result;
        }

        function testExternalResources() {
            const resultDiv = document.getElementById('resourceResult');
            let result = 'ğŸ“¦ å¤–éƒ¨èµ„æºæµ‹è¯•:\n\n';
            
            // æ£€æµ‹ethers.jsæ˜¯å¦åŠ è½½
            if (typeof ethers !== 'undefined') {
                result += 'âœ… ethers.js CDNåŠ è½½æˆåŠŸ\n';
                result += `ç‰ˆæœ¬: ${ethers.version}\n`;
                resultDiv.className = 'result success';
            } else {
                result += 'âŒ ethers.js CDNåŠ è½½å¤±è´¥\n';
                result += 'file://åè®®å¯èƒ½é˜»æ­¢äº†CDNèµ„æº\n';
                resultDiv.className = 'result error';
            }
            
            // æµ‹è¯•å›¾ç‰‡åŠ è½½
            const img = new Image();
            img.onload = function() {
                result += 'âœ… å¤–éƒ¨å›¾ç‰‡åŠ è½½æˆåŠŸ\n';
                resultDiv.textContent = result;
            };
            img.onerror = function() {
                result += 'âŒ å¤–éƒ¨å›¾ç‰‡åŠ è½½å¤±è´¥\n';
                resultDiv.textContent = result;
                resultDiv.className = 'result error';
            };
            img.src = 'https://via.placeholder.com/1x1.png';
            
            resultDiv.textContent = result;
        }
    </script>
</body>
</html>
