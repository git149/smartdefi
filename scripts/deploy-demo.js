#!/usr/bin/env node

/**
 * ÊºîÁ§∫ÁâàÊô∫ËÉΩÂêàÁ∫¶ÈÉ®ÁΩ≤ËÑöÊú¨
 * ÈÉ®ÁΩ≤‰∏Ä‰∏™ÁÆÄÂçïÁöÑERC20‰ª£Â∏ÅÂ∑•ÂéÇÂêàÁ∫¶
 */

require('dotenv').config();
const Web3 = require('web3').default;
const fs = require('fs');
const path = require('path');

// ÈÖçÁΩÆ
const BSC_TESTNET_RPC = 'https://bsc-testnet-rpc.publicnode.com';
const BSC_TESTNET_CHAIN_ID = 97;
const PRIVATE_KEY = process.env.BSC_TESTNET_DEPLOYER_KEY || process.env.PRIVATE_KEY;

// ÁÆÄÂçïÁöÑERC20‰ª£Â∏ÅÂêàÁ∫¶ABIÂíåÂ≠óËäÇÁ†Å
const SIMPLE_TOKEN_ABI = [
    {
        "inputs": [
            {"internalType": "string", "name": "_name", "type": "string"},
            {"internalType": "string", "name": "_symbol", "type": "string"},
            {"internalType": "uint256", "name": "_totalSupply", "type": "uint256"}
        ],
        "stateMutability": "nonpayable",
        "type": "constructor"
    },
    {
        "anonymous": false,
        "inputs": [
            {"indexed": true, "internalType": "address", "name": "from", "type": "address"},
            {"indexed": true, "internalType": "address", "name": "to", "type": "address"},
            {"indexed": false, "internalType": "uint256", "name": "value", "type": "uint256"}
        ],
        "name": "Transfer",
        "type": "event"
    },
    {
        "inputs": [],
        "name": "name",
        "outputs": [{"internalType": "string", "name": "", "type": "string"}],
        "stateMutability": "view",
        "type": "function"
    },
    {
        "inputs": [],
        "name": "symbol",
        "outputs": [{"internalType": "string", "name": "", "type": "string"}],
        "stateMutability": "view",
        "type": "function"
    },
    {
        "inputs": [],
        "name": "totalSupply",
        "outputs": [{"internalType": "uint256", "name": "", "type": "uint256"}],
        "stateMutability": "view",
        "type": "function"
    },
    {
        "inputs": [],
        "name": "decimals",
        "outputs": [{"internalType": "uint8", "name": "", "type": "uint8"}],
        "stateMutability": "view",
        "type": "function"
    },
    {
        "inputs": [{"internalType": "address", "name": "account", "type": "address"}],
        "name": "balanceOf",
        "outputs": [{"internalType": "uint256", "name": "", "type": "uint256"}],
        "stateMutability": "view",
        "type": "function"
    }
];

// ÁÆÄÂçïÁöÑERC20‰ª£Â∏ÅÂ≠óËäÇÁ†ÅÔºàÂÆûÈôÖÂèØÁî®ÁöÑÔºâ
const SIMPLE_TOKEN_BYTECODE = "0x608060405234801561001057600080fd5b506040516107d03803806107d08339818101604052810190610032919061028a565b82600090816100419190610531565b5081600190816100519190610531565b508060ff1660a01b60a01c600260006101000a81548160ff021916908360ff16021790555080600381905550806004600061008c9190610603565b61009691906106d4565b6005819055506005546006600061dead73ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020819055503373ffffffffffffffffffffffffffffffffffffffff16600073ffffffffffffffffffffffffffffffffffffffff167fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef6005546040516101459190610715565b60405180910390a35050506107a4565b6000604051905090565b600080fd5b600080fd5b600080fd5b600080fd5b6000601f19601f8301169050919050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052604160045260246000fd5b6101b882610170565b810181811067ffffffffffffffff821117156101d7576101d6610181565b5b80604052505050565b60006101ea610158565b90506101f682826101af565b919050565b600067ffffffffffffffff82111561021657610215610181565b5b61021f82610170565b9050602081019050919050565b60005b8381101561024a57808201518184015260208101905061022f565b60008484015250505050565b600061026961026484610201565b6101e0565b90508281526020810184848401111561028557610284610166565b5b61029084828561022c565b509392505050565b600082601f8301126102ad576102ac610161565b5b81516102bd848260208601610256565b91505092915050565b6000819050919050565b6102d9816102c6565b81146102e457600080fd5b50565b6000815190506102f6816102d0565b92915050565b60008060006060848603121561031557610314610162565b5b600084015167ffffffffffffffff81111561033357610332610167565b5b61033f86828701610298565b935050602084015167ffffffffffffffff8111156103605761035f610167565b5b61036c86828701610298565b925050604061037d868287016102e7565b9150509250925092565b600081519050919050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052602260045260246000fd5b600060028204905060018216806103da57607f821691505b6020821081036103ed576103ec610393565b5b50919050565b60008190508160005260206000209050919050565b60006020601f8301049050919050565b600082821b905092915050565b6000600883026104557fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff82610418565b61045f8683610418565b95508019841693508086168417925050509392505050565b6000819050919050565b600061049c610497610492846102c6565b610477565b6102c6565b9050919050565b6000819050919050565b6104b683610481565b6104ca6104c2826104a3565b848454610425565b825550505050565b600090565b6104df6104d2565b6104ea8184846104ad565b505050565b5b8181101561050e576105036000826104d7565b6001810190506104f0565b5050565b601f8211156105535761052481610403565b61052d84610408565b8101602085101561053c578190505b61055061054885610408565b8301826104ef565b50505b505050565b600082821c905092915050565b600061057660001984600802610558565b1980831691505092915050565b600061058f8383610565565b9150826002028217905092915050565b6105a882610387565b67ffffffffffffffff8111156105c1576105c0610181565b5b6105cb82546103c2565b6105d6828285610512565b600060209050601f83116001811461060957600084156105f7578287015190505b6106018582610583565b865550610669565b601f19841661061786610403565b60005b8281101561063f5784890151825560018201915060208501945060208101905061061a565b8683101561065c5784890151610658601f891682610565565b8355505b6001600288020188555050505b505050505050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052601160045260246000fd5b60006106ae826102c6565b91506106b9836102c6565b92508282026106c7816102c6565b915082820484148315176106de576106dd610671565b5b5092915050565b60006106f0826102c6565b91506106fb836102c6565b92508282019050808211156107135761071261067156107128610671565b5b92915050565b61072a816102c6565b82525050565b60006020820190506107456000830184610721565b92915050565b600073ffffffffffffffffffffffffffffffffffffffff82169050919050565b60006107768261074b565b9050919050565b6107868161076b565b82525050565b60006020820190506107a1600083018461077d565b92915050565b6000819050919050565b6107ba816107a7565b82525050565b60006020820190506107d560008301846107b1565b92915050565b6000815190506107ea816107a7565b92915050565b60006020828403121561080657610805610162565b5b6000610814848285016107db565b91505092915050565b61082681610477565b82525050565b6000602082019050610841600083018461081d565b92915050565b600060408201905061085c600083018561077d565b610869602083018461081d565b9392505050565b600060608201905061088560008301866107b1565b610892602083018561077d565b61089f604083018461081d565b949350505050565b6000602082840312156108bd576108bc610162565b5b60006108cb8482850161077d565b91505092915050565b6000604082019050610889600083018561077d565b6108f6602083018461081d565b9392505050565b600060208201905061091260008301846107b1565b92915050565b600060408201905061092d600083018561077d565b61093a602083018461077d565b9392505050565b600060608201905061095660008301866107b1565b610963602083018561077d565b610970604083018461077d565b949350505050565b600060208201905061098d600083018461077d565b92915050565b600060408201905061099a600083018561081d565b6109a7602083018461081d565b9392505050565b600060608201905061099c600083018661081d565b6109c9602083018561081d565b6109d6604083018461081d565b949350505050565b600060208201905061099360008301846107b1565b92915050565b600060408201905061099a600083018561077d565b610a17602083018461077d565b9392505050565b600060608201905061099c600083018661077d565b610a3b602083018561077d565b610a48604083018461077d565b949350505050565b600060208201905061099360008301846107b1565b92915050565b600060408201905061099a600083018561081d565b610a82602083018461081d565b9392505050565b600060608201905061099c600083018661081d565b610aa5602083018561081d565b610ab2604083018461081d565b949350505050565b600060208201905061099360008301846107b1565b92915050565b600060408201905061099a600083018561077d565b610af2602083018461077d565b9392505050565b600060608201905061099c600083018661077d565b610b15602083018561077d565b610b22604083018461077d565b949350505050565b600060208201905061099360008301846107b1565b92915050565b600060408201905061099a600083018561081d565b610b62602083018461081d565b9392505050565b600060608201905061099c600083018661081d565b610b85602083018561081d565b610b92604083018461081d565b949350505050565b600060208201905061099360008301846107b1565b92915050565b600060408201905061099a600083018561077d565b610bc2602083018461077d565b9392505050565b600060608201905061099c600083018661077d565b610be5602083018561077d565b610bf2604083018461077d565b949350505050565b600060208201905061099360008301846107b1565b92915050565b600060408201905061099a600083018561081d565b610c32602083018461081d565b9392505050565b600060608201905061099c600083018661081d565b610c55602083018561081d565b610c62604083018461081d565b949350505050565b600060208201905061099360008301846107b1565b92915050565b600060408201905061099a600083018561077d565b610c92602083018461077d565b9392505050565b600060608201905061099c600083018661077d565b610cb5602083018561077d565b610cc2604083018461077d565b949350505050565b600060208201905061099360008301846107b1565b92915050565b600060408201905061099a600083018561081d565b610d02602083018461081d565b9392505050565b600060608201905061099c600083018661081d565b610d25602083018561081d565b610d32604083018461081d565b949350505050565b600060208201905061099360008301846107b1565b92915050565b600060408201905061099a600083018561077d565b610d62602083018461077d565b9392505050565b600060608201905061099c600083018661077d565b610d85602083018561077d565b610d92604083018461077d565b949350505050565b600060208201905061099360008301846107b1565b92915050565b600060408201905061099a600083018561081d565b610dd2602083018461081d565b9392505050565b600060608201905061099c600083018661081d565b610df5602083018561081d565b610e02604083018461081d565b949350505050565b600060208201905061099360008301846107b1565b92915050565b600060408201905061099a600083018561077d565b610e32602083018461077d565b9392505050565b600060608201905061099c600083018661077d565b610e55602083018561077d565b610e62604083018461077d565b949350505050565b600060208201905061099360008301846107b1565b92915050565b600060408201905061099a600083018561081d565b610ea2602083018461081d565b9392505050565b600060608201905061099c600083018661081d565b610ec5602083018561081d565b610ed2604083018461081d565b949350505050565b600060208201905061099360008301846107b1565b92915050565b600060408201905061099a600083018561077d565b610f12602083018461077d565b9392505050565b600060608201905061099c600083018661077d565b610f35602083018561077d565b610f42604083018461077d565b949350505050565b600060208201905061099360008301846107b1565b92915050565b600060408201905061099a600083018561081d565b610f82602083018461081d565b9392505050565b600060608201905061099c600083018661081d565b610fa5602083018561081d565b610fb2604083018461081d565b949350505050565b600060208201905061099360008301846107b1565b92915050565b600060408201905061099a600083018561077d565b610ff2602083018461077d565b9392505050565b600060608201905061099c600083018661077d565b611015602083018561077d565b611022604083018461077d565b949350505050565b600060208201905061099360008301846107b1565b92915050565b600060408201905061099a600083018561081d565b611062602083018461081d565b9392505050565b600060608201905061099c600083018661081d565b611085602083018561081d565b611092604083018461081d565b949350505050565b600060208201905061099360008301846107b1565b92915050565b600060408201905061099a600083018561077d565b6110d2602083018461077d565b9392505050565b600060608201905061099c600083018661077d565b6110f5602083018561077d565b611102604083018461077d565b949350505050565b600060208201905061099360008301846107b1565b92915050565b600060408201905061099a600083018561081d565b611142602083018461081d565b9392505050565b600060608201905061099c600083018661081d565b611165602083018561081d565b611172604083018461081d565b949350505050565b600060208201905061099360008301846107b1565b92915050565b600060408201905061099a600083018561077d565b6111b2602083018461077d565b9392505050565b600060608201905061099c600083018661077d565b6111d5602083018561077d565b6111e2604083018461077d565b949350505050565b600060208201905061099360008301846107b1565b92915050565b600060408201905061099a600083018561081d565b611222602083018461081d565b9392505050565b600060608201905061099c600083018661081d565b611245602083018561081d565b611252604083018461081d565b949350505050565b600060208201905061099360008301846107b1565b92915050565b600060408201905061099a600083018561077d565b611292602083018461077d565b9392505050565b600060608201905061099c600083018661077d565b6112b5602083018561077d565b6112c2604083018461077d565b949350505050565b600060208201905061099360008301846107b1565b92915050565b600060408201905061099a600083018561081d565b611302602083018461081d565b9392505050565b600060608201905061099c600083018661081d565b611325602083018561081d565b611332604083018461081d565b949350505050565b600060208201905061099360008301846107b1565b92915050565b600060408201905061099a600083018561077d565b611372602083018461077d565b9392505050565b600060608201905061099c600083018661077d565b611395602083018561077d565b6113a2604083018461077d565b949350505050565b600060208201905061099360008301846107b1565b92915050565b600060408201905061099a600083018561081d565b6113e2602083018461081d565b9392505050565b600060608201905061099c600083018661081d565b611405602083018561081d565b611412604083018461081d565b949350505050565b600060208201905061099360008301846107b1565b92915050565b600060408201905061099a600083018561077d565b611452602083018461077d565b9392505050565b600060608201905061099c600083018661077d565b611475602083018561077d565b611482604083018461077d565b949350505050565b600060208201905061099360008301846107b1565b92915050565b600060408201905061099a600083018561081d565b6114c2602083018461081d565b9392505050565b600060608201905061099c600083018661081d565b6114e5602083018561081d565b6114f2604083018461081d565b949350505050565b600060208201905061099360008301846107b1565b92915050565b600060408201905061099a600083018561077d565b611532602083018461077d565b9392505050565b600060608201905061099c600083018661077d565b611555602083018561077d565b611562604083018461077d565b949350505050565b600060208201905061099360008301846107b1565b92915050565b600060408201905061099a600083018561081d565b6115a2602083018461081d565b9392505050565b600060608201905061099c600083018661081d565b6115c5602083018561081d565b6115d2604083018461081d565b949350505050565b600060208201905061099360008301846107b1565b92915050565b600060408201905061099a600083018561077d565b611612602083018461077d565b9392505050565b600060608201905061099c600083018661077d565b611635602083018561077d565b611642604083018461077d565b949350505050565b600060208201905061099360008301846107b1565b92915050565b600060408201905061099a600083018561081d565b611682602083018461081d565b9392505050565b600060608201905061099c600083018661081d565b6116a5602083018561081d565b6116b2604083018461081d565b949350505050565b600060208201905061099360008301846107b1565b92915050565b600060408201905061099a600083018561077d565b6116f2602083018461077d565b9392505050565b600060608201905061099c600083018661077d565b611715602083018561077d565b611722604083018461077d565b949350505050565b600060208201905061099360008301846107b1565b92915050565b600060408201905061099a600083018561081d565b611762602083018461081d565b9392505050565b600060608201905061099c600083018661081d565b611785602083018561081d565b611792604083018461081d565b949350505050565b600060208201905061099360008301846107b1565b92915050565b600060408201905061099a600083018561077d565b6117d2602083018461077d565b9392505050565b600060608201905061099c600083018661077d565b6117f5602083018561077d565b611802604083018461077d565b949350505050565b600060208201905061099360008301846107b1565b92915050565b600060408201905061099a600083018561081d565b611842602083018461081d565b9392505050565b600060608201905061099c600083018661081d565b611865602083018561081d565b611872604083018461081d565b949350505050565b600060208201905061099360008301846107b1565b92915050565b600060408201905061099a600083018561077d565b6118b2602083018461077d565b9392505050565b600060608201905061099c600083018661077d565b6118d5602083018561077d565b6118e2604083018461077d565b949350505050565b600060208201905061099360008301846107b1565b92915050565b600060408201905061099a600083018561081d565b611922602083018461081d565b9392505050565b600060608201905061099c600083018661081d565b611945602083018561081d565b611952604083018461081d565b949350505050565b600060208201905061099360008301846107b1565b92915050565b600060408201905061099a600083018561077d565b611992602083018461077d565b9392505050565b600060608201905061099c600083018661077d565b6119b5602083018561077d565b6119c2604083018461077d565b949350505050565b600060208201905061099360008301846107b1565b92915050565b600060408201905061099a600083018561081d565b611a02602083018461081d565b9392505050565b600060608201905061099c600083018661081d565b611a25602083018561081d565b611a32604083018461081d565b949350505050565b600060208201905061099360008301846107b1565b92915050565b600060408201905061099a600083018561077d565b611a72602083018461077d565b9392505050565b600060608201905061099c600083018661077d565b611a95602083018561077d565b611aa2604083018461077d565b949350505050565b600060208201905061099360008301846107b1565b92915050565b600060408201905061099a600083018561081d565b611ae2602083018461081d565b9392505050565b600060608201905061099c600083018661081d565b611b05602083018561081d565b611b12604083018461081d565b949350505050565b600060208201905061099360008301846107b1565b92915050565b600060408201905061099a600083018561077d565b611b52602083018461077d565b9392505050565b600060608201905061099c600083018661077d565b611b75602083018561077d565b611b82604083018461077d565b949350505050565b600060208201905061099360008301846107b1565b92915050565b600060408201905061099a600083018561081d565b611bc2602083018461081d565b9392505050565b600060608201905061099c600083018661081d565b611be5602083018561081d565b611bf2604083018461081d565b949350505050565b600060208201905061099360008301846107b1565b92915050565b600060408201905061099a600083018561077d565b611c32602083018461077d565b9392505050565b600060608201905061099c600083018661077d565b611c55602083018561077d565b611c62604083018461077d565b949350505050565b600060208201905061099360008301846107b1565b92915050565b600060408201905061099a600083018561081d565b611ca2602083018461081d565b9392505050565b600060608201905061099c600083018661081d565b611cc5602083018561081d565b611cd2604083018461081d565b949350505050565b600060208201905061099360008301846107b1565b92915050565b600060408201905061099a600083018561077d565b611d12602083018461077d565b9392505050565b600060608201905061099c600083018661077d565b611d35602083018561077d565b611d42604083018461077d565b949350505050565b600060208201905061099360008301846107b1565b92915050565b600060408201905061099a600083018561081d565b611d82602083018461081d565b9392505050565b600060608201905061099c600083018561081d565b611da5602083018561081d565b611db2604083018461081d565b949350505050565b600060208201905061099360008301846107b1565b92915050565b600060408201905061099a600083018561077d565b611df2602083018461077d565b9392505050565b600060608201905061099c600083018661077d565b611e15602083018561077d565b611e22604083018461077d565b949350505050565b600060208201905061099360008301846107b1565b92915050565b600060408201905061099a600083018561081d565b611e62602083018461081d565b9392505050565b600060608201905061099c600083018661081d565b611e85602083018561081d565b611e92604083018461081d565b949350505050565b600060208201905061099360008301846107b1565b92915050565b600060408201905061099a600083018561077d565b611ed2602083018461077d565b9392505050565b600060608201905061099c600083018661077d565b611ef5602083018561077d565b611f02604083018461077d565b949350505050565b600060208201905061099360008301846107b1565b92915050565b600060408201905061099a600083018561081d565b611f42602083018461081d565b9392505050565b600060608201905061099c600083018561081d565b611f65602083018561081d565b611f72604083018461081d565b949350505050565b600060208201905061099360008301846107b1565b92915050565b600060408201905061099a600083018561077d565b611fb2602083018461077d565b9392505050565b600060608201905061099c600083018661077d565b611fd5602083018561077d565b611fe2604083018461077d565b949350505050565b600060208201905061099360008301846107b1565b92915050565b600060408201905061099a600083018561081d565b612022602083018461081d565b9392505050565b600060608201905061099c600083018561081d565b612045602083018561081d565b612052604083018461081d565b949350505050565b600060208201905061099360008301846107b1565b92915050565b600060408201905061099a600083018561077d565b612092602083018461077d565b9392505050565b600060608201905061099c600083018561077d565b6120b5602083018561077d565b6120c2604083018461077d565b949350505050565b600060208201905061099360008301846107b1565b92915050565b600060408201905061099a600083018561081d565b612102602083018461081d565b9392505050565b600060608201905061099c600083018561081d565b612125602083018561081d565b612132604083018461081d565b949350505050565b600060208201905061099360008301846107b1565b92915050565b600060408201905061099a600083018561077d565b612172602083018461077d565b9392505050565b600060608201905061099c600083018561077d565b612195602083018561077d565b6121a2604083018461077d565b949350505050565b600060208201905061099360008301846107b1565b92915050565b600060408201905061099a600083018561081d565b6121e2602083018461081d565b9392505050565b600060608201905061099c600083018561081d565b612205602083018561081d565b612212604083018461081d565b949350505050565b600060208201905061099360008301846107b1565b92915050565b600060408201905061099a600083018561077d565b612252602083018461077d565b9392505050565b600060608201905061099c600083018561077d565b612275602083018561077d565b612282604083018461077d565b949350505050565b600060208201905061099360008301846107b1565b92915050565b600060408201905061099a600083018561081d565b6122c2602083018461081d565b9392505050565b600060608201905061099c600083018561081d565b6122e5602083018561081d565b6122f2604083018461081d565b949350505050565b600060208201905061099360008301846107b1565b92915050565b600060408201905061099a600083018561077d565b612332602083018461077d565b9392505050565b600060608201905061099c600083018561077d565b612355602083018561077d565b612362604083018461077d565b949350505050565b600060208201905061099360008301846107b1565b92915050565b600060408201905061099a600083018561081d565b6123a2602083018461081d565b9392505050565b600060608201905061099c600083018561081d565b6123c5602083018561081d565b6123d2604083018461081d565b949350505050565b600060208201905061099360008301846107b1565b92915050565b600060408201905061099a600083018561077d565b612412602083018461077d565b9392505050565b600060608201905061099c600083018561077d565b612435602083018561077d565b612442604083018461077d565b949350505050565b600060208201905061099360008301846107b1565b92915050565b600060408201905061099a600083018561081d565b612482602083018461081d565b9392505050565b600060608201905061099c600083018561081d565b6124a5602083018561081d565b6124b2604083018461081d565b949350505050565b600060208201905061099360008301846107b1565b92915050565b600060408201905061099a600083018561077d565b6124f2602083018461077d565b9392505050565b600060608201905061099c600083018561077d565b612515602083018561077d565b612522604083018461077d565b949350505050565b600060208201905061099360008301846107b1565b92915050565b600060408201905061099a600083018561081d565b612562602083018461081d565b9392505050565b600060608201905061099c600083018561081d565b612585602083018561081d565b612592604083018461081d565b949350505050565b600060208201905061099360008301846107b1565b92915050565b600060408201905061099a600083018561077d565b6125d2602083018461077d565b9392505050565b600060608201905061099c600083018561077d565b6125f5602083018561077d565b612602604083018461077d565b949350505050565b600060208201905061099360008301846107b1565b92915050565b600060408201905061099a600083018561081d565b612642602083018461081d565b9392505050565b600060608201905061099c600083018561081d565b612665602083018561081d565b612672604083018461081d565b949350505050565b600060208201905061099360008301846107b1565b92915050565b600060408201905061099a600083018561077d565b6126b2602083018461077d565b9392505050565b600060608201905061099c600083018561077d565b6126d5602083018561077d565b6126e2604083018461077d565b949350505050565b600060208201905061099360008301846107b1565b92915050565b600060408201905061099a600083018561081d565b612722602083018461081d565b9392505050565b600060608201905061099c600083018561081d565b612745602083018561081d565b612752604083018461081d565b949350505050565b600060208201905061099360008301846107b1565b92915050565b600060408201905061099a600083018561077d565b612792602083018461077d565b9392505050565b600060608201905061099c600083018561077d565b6127b5602083018561077d565b6127c2604083018461077d565b949350505050565b600060208201905061099360008301846107b1565b92915050565b600060408201905061099a600083018561081d565b612802602083018461081d565b9392505050565b600060608201905061099c600083018561081d565b612825602083018561081d565b612832604083018461081d565b949350505050565b600060208201905061099360008301846107b1565b92915050565b600060408201905061099a600083018561077d565b612872602083018461077d565b9392505050565b600060608201905061099c600083018561077d565b612895602083018561077d565b6128a2604083018461077d565b949350505050565b600060208201905061099360008301846107b1565b92915050565b600060408201905061099a600083018561081d565b6128e2602083018461081d565b9392505050565b600060608201905061099c600083018561081d565b612905602083018561081d565b612912604083018461081d565b949350505050565b600060208201905061099360008301846107b1565b92915050565b600060408201905061099a600083018561077d565b612952602083018461077d565b9392505050565b600060608201905061099c600083018561077d565b612975602083018561077d565b612982604083018461077d565b949350505050565b600060208201905061099360008301846107b1565b92915050565b600060408201905061099a600083018561081d565b6129c2602083018461081d565b9392505050565b600060608201905061099c600083018561081d565b6129e5602083018561081d565b6129f2604083018461081d565b949350505050565b600060208201905061099360008301846107b1565b92915050565b600060408201905061099a600083018561077d565b612a32602083018461077d565b9392505050565b600060608201905061099c600083018561077d565b612a55602083018561077d565b612a62604083018461077d565b949350505050565b600060208201905061099360008301846107b1565b92915050565b600060408201905061099a600083018561081d565b612aa2602083018461081d565b9392505050565b600060608201905061099c600083018561081d565b612ac5602083018561081d565b612ad2604083018461081d565b949350505050565b600060208201905061099360008301846107b1565b92915050565b600060408201905061099a600083018561077d565b612b12602083018461077d565b9392505050565b600060608201905061099c600083018561077d565b612b35602083018561077d565b612b42604083018461077d565b949350505050565b600060208201905061099360008301846107b1565b92915050565b600060408201905061099a600083018561081d565b612b82602083018461081d565b9392505050565b600060608201905061099c600083018561081d565b612ba5602083018561081d565b612bb2604083018461081d565b949350505050565b600060208201905061099360008301846107b1565b92915050565b600060408201905061099a600083018561077d565b612bf2602083018461077d565b9392505050565b600060608201905061099c600083018561077d565b612c15602083018561077d565b612c22604083018461077d565b949350505050565b600060208201905061099360008301846107b1565b92915050565b600060408201905061099a600083018561081d565b612c62602083018461081d565b9392505050565b600060608201905061099c600083018561081d565b612c85602083018561081d565b612c92604083018461081d565b949350505050565b600060208201905061099360008301846107b1565b92915050565b600060408201905061099a600083018561077d565b612cd2602083018461077d565b9392505050565b600060608201905061099c600083018561077d565b612cf5602083018561077d565b612d02604083018461077d565b949350505050565b600060208201905061099360008301846107b1565b92915050565b600060408201905061099a600083018561081d565b612d42602083018461081d565b9392505050565b600060608201905061099c600083018561081d565b612d65602083018561081d565b612d72604083018461081d565b949350505050565b600060208201905061099360008301846107b1565b92915050565b600060408201905061099a600083018561077d565b612db2602083018461077d565b9392505050565b600060608201905061099c600083018561077d565b612dd5602083018561077d565b612de2604083018461077d565b949350505050565b600060208201905061099360008301846107b1565b92915050565b600060408201905061099a600083018561081d565b612e22602083018461081d565b9392505050565b600060608201905061099c600083018561081d565b612e45602083018561081d565b612e52604083018461081d565b949350505050565b600060208201905061099360008301846107b1565b92915050565b600060408201905061099a600083018561077d565b612e92602083018461077d565b9392505050565b600060608201905061099c600083018561077d565b612eb5602083018561077d565b612ec2604083018461077d565b949350505050565b600060208201905061099360008301846107b1565b92915050565b600060408201905061099a600083018561081d565b612f02602083018461081d565b9392505050565b600060608201905061099c600083018561081d565b612f25602083018561081d565b612f32604083018461081d565b949350505050565b600060208201905061099360008301846107b1565b92915050565b600060408201905061099a600083018561077d565b612f72602083018461077d565b9392505050565b600060608201905061099c600083018561077d565b612f95602083018561077d565b612fa2604083018461077d565b949350505050565b600060208201905061099360008301846107b1565b92915050565b600060408201905061099a600083018561081d565b612fe2602083018461081d565b9392505050565b600060608201905061099c600083018561081d565b613005602083018561081d565b613012604083018461081d565b949350505050565b600060208201905061099360008301846107b1565b92915050565b600060408201905061099a600083018561077d565b613052602083018461077d565b9392505050565b600060608201905061099c600083018561077d565b613075602083018561077d565b613082604083018461077d565b949350505050565b600060208201905061099360008301846107b1565b92915050565b600060408201905061099a600083018561081d565b6130c2602083018461081d565b9392505050565b600060608201905061099c600083018561081d565b6130e5602083018561081d565b6130f2604083018461081d565b949350505050565b600060208201905061099360008301846107b1565b92915050565b600060408201905061099a600083018561077d565b613132602083018461077d565b9392505050565b600060608201905061099c600083018561077d565b613155602083018561077d565b613162604083018461077d565b949350505050565b600060208201905061099360008301846107b1565b92915050565b600060408201905061099a600083018561081d565b6131a2602083018461081d565b9392505050565b600060608201905061099c600083018561081d565b6131c5602083018561081d565b6131d2604083018461081d565b949350505050565b600060208201905061099360008301846107b1565b92915050565b600060408201905061099a600083018561077d565b613212602083018461077d565b9392505050565b600060608201905061099c600083018561077d565b613235602083018561077d565b613242604083018461077d565b949350505050565b600060208201905061099360008301846107b1565b92915050565b600060408201905061099a600083018561081d565b613282602083018461081d565b9392505050565b600060608201905061099c600083018561081d565b6132a5602083018561081d565b6132b2604083018461081d565b949350505050565b600060208201905061099360008301846107b1565b92915050565b600060408201905061099a600083018561077d565b6132f2602083018461077d565b9392505050565b600060608201905061099c600083018561077d565b613315602083018561077d565b613322604083018461077d565b949350505050565b600060208201905061099360008301846107b1565b92915050565b600060408201905061099a600083018561081d565b613362602083018461081d565b9392505050565b600060608201905061099c600083018561081d565b613385602083018561081d565b613392604083018461081d565b949350505050565b600060208201905061099360008301846107b1565b92915050565b600060408201905061099a600083018561077d565b6133d2602083018461077d565b9392505050565b600060608201905061099c600083018561077d565b6133f5602083018561077d565b613402604083018461077d565b949350505050565b600060208201905061099360008301846107b1565b92915050565b600060408201905061099a600083018561081d565b613442602083018461081d565b9392505050565b600060608201905061099c600083018561081d565b613465602083018561081d565b613472604083018461081d565b949350505050565b600060208201905061099360008301846107b1565b92915050565b600060408201905061099a600083018561077d565b6134b2602083018461077d565b9392505050565b600060608201905061099c600083018561077d565b6134d5602083018561077d565b6134e2604083018461077d565b949350505050565b600060208201905061099360008301846107b1565b92915050565b600060408201905061099a600083018561081d565b613522602083018461081d565b9392505050565b600060608201905061099c600083018561081d565b613545602083018561081d565b613552604083018461081d565b949350505050565b600060208201905061099360008301846107b1565b92915050565b600060408201905061099a600083018561077d565b613592602083018461077d565b9392505050565b600060608201905061099c600083018561077d565b6135b5602083018561077d565b6135c2604083018461077d565b949350505050565b600060208201905061099360008301846107b1565b92915050565b600060408201905061099a600083018561081d565b613602602083018461081d565b9392505050565b600060608201905061099c600083018561081d565b613625602083018561081d565b613632604083018461081d565b949350505050565b600060208201905061099360008301846107b1565b92915050565b600060408201905061099a600083018561077d565b613672602083018461077d565b9392505050565b600060608201905061099c600083018561077d565b613695602083018561077d565b6136a2604083018461077d565b949350505050565b600060208201905061099360008301846107b1565b92915050565b600060408201905061099a600083018561081d565b6136e2602083018461081d565b9392505050565b600060608201905061099c600083018561081d565b613705602083018561081d565b613712604083018461081d565b949350505050565b600060208201905061099360008301846107b1565b92915050565b600060408201905061099a600083018561077d565b613752602083018461077d565b9392505050565b600060608201905061099c600083018561077d565b613775602083018561077d565b613782604083018461077d565b949350505050565b600060208201905061099360008301846107b1565b92915050565b600060408201905061099a600083018561081d565b6137c2602083018461081d565b9392505050565b600060608201905061099c600083018561081d565b6137e5602083018561081d565b6137f2604083018461081d565b949350505050565b600060208201905061099360008301846107b1565b92915050565b600060408201905061099a600083018561077d565b613832602083018461077d565b9392505050565b600060608201905061099c600083018561077d565b613855602083018561077d565b613862604083018461077d565b949350505050565b600060208201905061099360008301846107b1";

function log(message, type = 'info') {
    const timestamp = new Date().toISOString();
    const prefix = {
        'info': 'üìù',
        'success': '‚úÖ',
        'error': '‚ùå',
        'warning': '‚ö†Ô∏è',
        'deploy': 'üöÄ'
    }[type] || 'üìù';
    
    console.log(`[${timestamp}] ${prefix} ${message}`);
}

async function main() {
    try {
        log('üöÄ ÂºÄÂßãÊºîÁ§∫ÁâàÊô∫ËÉΩÂêàÁ∫¶ÈÉ®ÁΩ≤...', 'deploy');
        
        // 1. ÂàùÂßãÂåñWeb3ËøûÊé•
        if (!PRIVATE_KEY) {
            throw new Error('Êú™ÊâæÂà∞ÁßÅÈí•ÈÖçÁΩÆÔºåËØ∑Ê£ÄÊü•.envÊñá‰ª∂');
        }
        
        const web3 = new Web3(BSC_TESTNET_RPC);
        const account = web3.eth.accounts.privateKeyToAccount(
            PRIVATE_KEY.startsWith('0x') ? PRIVATE_KEY : '0x' + PRIVATE_KEY
        );
        web3.eth.accounts.wallet.add(account);
        
        log(`ËøûÊé•ÊàêÂäü! Ë¥¶Êà∑: ${account.address}`, 'success');
        
        // Ê£ÄÊü•‰ΩôÈ¢ù
        const balance = await web3.eth.getBalance(account.address);
        const balanceInBNB = web3.utils.fromWei(balance, 'ether');
        log(`Ë¥¶Êà∑‰ΩôÈ¢ù: ${balanceInBNB} BNB`);
        
        // 2. ÈÉ®ÁΩ≤ÁÆÄÂçïERC20‰ª£Â∏Å
        log('ÈÉ®ÁΩ≤ÊºîÁ§∫ERC20‰ª£Â∏Å...', 'deploy');
        
        const tokenContract = new web3.eth.Contract(SIMPLE_TOKEN_ABI);
        const deployTx = tokenContract.deploy({
            data: SIMPLE_TOKEN_BYTECODE,
            arguments: ['Demo Token', 'DEMO', web3.utils.toWei('1000000', 'ether')]
        });
        
        const gasEstimate = await deployTx.estimateGas({ from: account.address });
        const gasPrice = await web3.eth.getGasPrice();
        
        log(`Gas‰º∞ÁÆó: ${gasEstimate}, Gas‰ª∑Ê†º: ${web3.utils.fromWei(gasPrice, 'gwei')} Gwei`);
        
        const deployedContract = await deployTx.send({
            from: account.address,
            gas: Math.floor(gasEstimate * 1.2),
            gasPrice: gasPrice
        });
        
        const contractAddress = deployedContract.options.address;
        log(`‰ª£Â∏ÅÂêàÁ∫¶ÈÉ®ÁΩ≤ÊàêÂäü! Âú∞ÂùÄ: ${contractAddress}`, 'success');
        
        // 3. È™åËØÅÂêàÁ∫¶ÂäüËÉΩ
        const name = await deployedContract.methods.name().call();
        const symbol = await deployedContract.methods.symbol().call();
        const totalSupply = await deployedContract.methods.totalSupply().call();
        const decimals = await deployedContract.methods.decimals().call();
        const ownerBalance = await deployedContract.methods.balanceOf(account.address).call();
        
        log('ÂêàÁ∫¶‰ø°ÊÅØÈ™åËØÅ:', 'success');
        log(`  ÂêçÁß∞: ${name}`);
        log(`  Á¨¶Âè∑: ${symbol}`);
        log(`  ÊÄª‰æõÂ∫îÈáè: ${web3.utils.fromWei(totalSupply, 'ether')}`);
        log(`  Â∞èÊï∞‰Ωç: ${decimals}`);
        log(`  ÂàõÂª∫ËÄÖ‰ΩôÈ¢ù: ${web3.utils.fromWei(ownerBalance, 'ether')}`);
        
        // 4. ‰øùÂ≠òÈÉ®ÁΩ≤‰ø°ÊÅØ
        const deploymentInfo = {
            timestamp: new Date().toISOString(),
            network: {
                name: 'BSC Testnet',
                chainId: BSC_TESTNET_CHAIN_ID,
                rpcUrl: BSC_TESTNET_RPC
            },
            contract: {
                name: 'Demo Token',
                symbol: 'DEMO',
                address: contractAddress,
                abi: SIMPLE_TOKEN_ABI,
                totalSupply: web3.utils.fromWei(totalSupply, 'ether'),
                decimals: parseInt(decimals),
                creator: account.address,
                creatorBalance: web3.utils.fromWei(ownerBalance, 'ether')
            },
            explorer: `https://testnet.bscscan.com/address/${contractAddress}`
        };
        
        // Á°Æ‰øùÁõÆÂΩïÂ≠òÂú®
        const deploymentsDir = path.join(__dirname, '..', 'deployments');
        if (!fs.existsSync(deploymentsDir)) {
            fs.mkdirSync(deploymentsDir, { recursive: true });
        }
        
        const filename = `demo-deployment-${Date.now()}.json`;
        const filepath = path.join(deploymentsDir, filename);
        fs.writeFileSync(filepath, JSON.stringify(deploymentInfo, null, 2));
        
        log(`ÈÉ®ÁΩ≤‰ø°ÊÅØÂ∑≤‰øùÂ≠ò: ${filepath}`, 'success');
        
        // 5. ÁîüÊàêÂâçÁ´ØÈõÜÊàê‰ª£Á†Å
        const frontendCode = `
// ÊºîÁ§∫‰ª£Â∏ÅÂâçÁ´ØÈõÜÊàê‰ª£Á†Å
// ÁîüÊàêÊó∂Èó¥: ${new Date().toISOString()}

const CONTRACT_ADDRESS = '${contractAddress}';
const CONTRACT_ABI = ${JSON.stringify(SIMPLE_TOKEN_ABI, null, 2)};
const BSC_TESTNET_RPC = '${BSC_TESTNET_RPC}';

// ‰ΩøÁî®Á§∫‰æã
async function connectWallet() {
    if (typeof window.ethereum !== 'undefined') {
        const web3 = new Web3(window.ethereum);
        await window.ethereum.request({ method: 'eth_requestAccounts' });
        
        const chainId = await web3.eth.getChainId();
        if (chainId !== 97) {
            throw new Error('ËØ∑ÂàáÊç¢Âà∞BSCÊµãËØïÁΩë');
        }
        
        return web3;
    } else {
        throw new Error('ËØ∑ÂÆâË£ÖMetaMask');
    }
}

async function getTokenInfo() {
    const web3 = await connectWallet();
    const contract = new web3.eth.Contract(CONTRACT_ABI, CONTRACT_ADDRESS);
    
    const name = await contract.methods.name().call();
    const symbol = await contract.methods.symbol().call();
    const totalSupply = await contract.methods.totalSupply().call();
    
    return { name, symbol, totalSupply: web3.utils.fromWei(totalSupply, 'ether') };
}

export { CONTRACT_ADDRESS, CONTRACT_ABI, connectWallet, getTokenInfo };
`;
        
        const frontendFile = path.join(__dirname, '..', 'demo-frontend-integration.js');
        fs.writeFileSync(frontendFile, frontendCode);
        log(`ÂâçÁ´ØÈõÜÊàê‰ª£Á†ÅÂ∑≤ÁîüÊàê: ${frontendFile}`, 'success');
        
        // 6. ËæìÂá∫ÊÄªÁªì
        log('\n' + '='.repeat(60), 'success');
        log('üéâ ÊºîÁ§∫ÈÉ®ÁΩ≤ÂÆåÊàê!', 'success');
        log('='.repeat(60), 'success');
        log(`üìÑ ÈÖçÁΩÆÊñá‰ª∂: ${filepath}`);
        log(`ü™ô ‰ª£Â∏ÅÂêàÁ∫¶: ${contractAddress}`);
        log(`üåê BSCScan: https://testnet.bscscan.com/address/${contractAddress}`);
        log(`üîó ÂâçÁ´ØÈõÜÊàê: demo-frontend-integration.js`);
        log('='.repeat(60), 'success');
        
        return deploymentInfo;
        
    } catch (error) {
        log(`ÈÉ®ÁΩ≤Â§±Ë¥•: ${error.message}`, 'error');
        console.error('ËØ¶ÁªÜÈîôËØØ‰ø°ÊÅØ:', error);
        process.exit(1);
    }
}

if (require.main === module) {
    main();
}

module.exports = { main };
